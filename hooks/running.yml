---
- name: Removing previous version of ansible
  file:
    path: ./ansible-testrunner/ansible
    state: absent

- name: Clone the ansible version to test
  git:
    repo: 'centos@{{ agent_public_ip}}:{{ base_location}}/{{ ansible_commit }}/ansible'
    dest: ./ansible-testrunner/ansible
    version: '{{ ansible_commit }}'

- name: Run the integration test suite
  shell: 'ansible/test/runner/ansible-test network-integration --continue-on-error --inventory /var/lib/nodepool/ansible-testrunner/inventory {{ platform }}_.* -v'
  args:
    chdir: './ansible-testrunner'
  ignore_errors: True
  register: integration_tests_suite
